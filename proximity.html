<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Leaflet Proximity Search</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            height: 600px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // Initialize the map
        var map = L.map('map').setView([51.505, -0.09], 13);

        // Add OpenStreetMap tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19
        }).addTo(map);

        // Add tree data as markers (example data)
        var trees = [
            { "type": "Feature", "geometry": { "type": "Point", "coordinates": [ -0.09, 51.505 ] }, "properties": { "name": "Tree 1" } },
            { "type": "Feature", "geometry": { "type": "Point", "coordinates": [ -0.08, 51.504 ] }, "properties": { "name": "Tree 2" } },
            { "type": "Feature", "geometry": { "type": "Point", "coordinates": [ -0.07, 51.506 ] }, "properties": { "name": "Tree 3" } },
            { "type": "Feature", "geometry": { "type": "Point", "coordinates": [ -0.06, 51.507 ] }, "properties": { "name": "Tree 4" } }
            // Add more tree data here
        ];

        var treeLayer = L.geoJSON(trees).addTo(map);

        // Function to find trees within a given radius (in meters) from a point
        function findTreesWithinRadius(lat, lng, radius) {
            var point = L.latLng(lat, lng);
            var nearbyTrees = [];

            treeLayer.eachLayer(function (layer) {
                var treeLatLng = layer.getLatLng();
                var distance = L.GeometryUtil.distance(map, point, treeLatLng);

                if (distance <= radius) {
                    nearbyTrees.push({
                        "name": layer.feature.properties.name,
                        "distance": distance,
                        "latlng": treeLatLng
                    });
                }
            });

            return nearbyTrees;
        }

        // Example usage: Find trees within 1 km of a given point
        var searchPoint = [51.505, -0.09];
        var radius = 1000; // 1 km in meters
        var results = findTreesWithinRadius(searchPoint[0], searchPoint[1], radius);

        console.log("Nearby trees:", results);

        // Highlight nearby trees on the map
        results.forEach(function (result) {
            L.marker(result.latlng).addTo(map)
                .bindPopup(result.name + "<br>Distance: " + Math.round(result.distance) + " meters")
                .openPopup();
        });

        // Optionally add a marker for the search point
        L.marker(searchPoint).addTo(map)
            .bindPopup("Search Point<br>Lat: " + searchPoint[0] + "<br>Lng: " + searchPoint[1])
            .openPopup();
    </script>
</body>
</html>
